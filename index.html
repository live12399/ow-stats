<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Overwatch 2 Meta & Trend</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: radial-gradient(circle, #282e54 0%, #0f1015 100%); background-attachment: fixed; color: #f0edff; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        h1 { text-shadow: 2px 2px 0px #ff9c00; color: #ff9c00; font-style: italic; }
        
        /* ì»¨íŠ¸ë¡¤ ì„¹ì…˜ */
        .controls { margin: 20px 0; display: flex; gap: 15px; }
        select { padding: 10px; background: #222; color: white; border-radius: 5px; }
        .filter-btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; background: #333; color: #ccc; }
        .filter-btn.active { background: #ff9c00; color: black; font-weight: bold; }

        /* í‹°ì–´ ì»¨í…Œì´ë„ˆ */
        .tier-row { display: flex; margin-bottom: 15px; background: rgba(30,30,30,0.6); border-radius: 8px; min-height: 120px; backdrop-filter: blur(5px); }
        .tier-label { width: 80px; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; font-family: 'Impact'; color: #000; }
        .tier-S { background: #ff7f7f; } .tier-A { background: #ffbf7f; } .tier-B { background: #ffff7f; } .tier-C { background: #ccffcc; }
        .hero-list { display: flex; flex-wrap: wrap; gap: 10px; padding: 15px; }

        /* ì˜ì›… ì¹´ë“œ */
        .hero-card { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; width: 90px; text-align: center; border-bottom: 4px solid #ccc; cursor: pointer; transition: 0.2s; }
        .hero-card:hover { transform: scale(1.05); border-color: #ff9c00; background: rgba(255,255,255,0.1); }
        .hero-img { width: 100%; height: 70px; border-radius: 5px; object-fit: cover; }
        .stats { font-size: 0.8rem; font-weight: bold; display: block; margin-top: 5px; }

        /* ê·¸ë˜í”„ ëª¨ë‹¬ íŒì—… */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: #1a1a1a; padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; border: 1px solid #444; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Overwatch 2 Meta Analysis</h1>
        <select id="rank-select">
            <option value="all">ğŸ† ì „ì²´</option>
            <option value="bronze">ğŸ¥‰ ë¸Œë¡ ì¦ˆ</option>
            <option value="silver">ğŸ¥ˆ ì‹¤ë²„</option>
            <option value="gold">ğŸ¥‡ ê³¨ë“œ</option>
            <option value="platinum">ğŸ’  í”Œë˜í‹°ë„˜</option>
            <option value="diamond">ğŸ’ ë‹¤ì´ì•„ëª¬ë“œ</option>
            <option value="master">ğŸ”® ë§ˆìŠ¤í„°</option>
            <option value="grandmaster">ğŸ”¥ ê·¸ë§ˆ</option>
        </select>
    </div>

    <div class="controls">
        <button class="filter-btn active" data-role="all">ì „ì²´</button>
        <button class="filter-btn" data-role="tank">ğŸ›¡ï¸ ëŒê²©</button>
        <button class="filter-btn" data-role="damage">âš”ï¸ ê³µê²©</button>
        <button class="filter-btn" data-role="support">ğŸš‘ ì§€ì›</button>
    </div>

    <div id="main-container">
        <div class="tier-row"><div class="tier-label tier-S">S</div><div id="list-S" class="hero-list"></div></div>
        <div class="tier-row"><div class="tier-label tier-A">A</div><div id="list-A" class="hero-list"></div></div>
        <div class="tier-row"><div class="tier-label tier-B">B</div><div id="list-B" class="hero-list"></div></div>
        <div class="tier-row"><div class="tier-label tier-C">C</div><div id="list-C" class="hero-list"></div></div>
    </div>

    <div id="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 id="modal-title" style="margin-top:0;">ì˜ì›… ì¶”ì„¸</h2>
            <canvas id="trendChart"></canvas>
            <p style="color:#888; font-size:12px; margin-top:15px;">* ìµœê·¼ 30ì¼ê°„ì˜ ìŠ¹ë¥  ë³€í™”ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        const roleMap = { /* ... ìœ„ì™€ ë™ì¼í•œ ë§¤í•‘ ë°ì´í„° ... */
            "dva": "tank", "doomfist": "tank", "junker-queen": "tank", "orisa": "tank", "ramattra": "tank", "reinhardt": "tank", "roadhog": "tank", "sigma": "tank", "winston": "tank", "wrecking-ball": "tank", "zarya": "tank", "mauga": "tank", "hazard": "tank",
            "ashe": "damage", "bastion": "damage", "cassidy": "damage", "echo": "damage", "genji": "damage", "hanzo": "damage", "junkrat": "damage", "mei": "damage", "pharah": "damage", "reaper": "damage", "sojourn": "damage", "soldier-76": "damage", "sombra": "damage", "symmetra": "damage", "torbjorn": "damage", "tracer": "damage", "widowmaker": "damage", "venture": "damage",
            "ana": "support", "baptiste": "support", "brigitte": "support", "illari": "support", "kiriko": "support", "lifeweaver": "support", "lucio": "support", "mercy": "support", "moira": "support", "zenyatta": "support", "juno": "support"
        };

        let allData = {}; 
        let historyData = [];
        let currentRank = 'all';
        let currentRole = 'all';
        let trendChart = null;

        // ë°ì´í„° ë¡œë“œ
        Promise.all([
            fetch('./heroes.json?t=' + Date.now()).then(r => r.json()),
            fetch('./history.json?t=' + Date.now()).then(r => r.json()).catch(() => [])
        ]).then(([current, history]) => {
            allData = current;
            historyData = history;
            render();
        });

        function render() {
            ['S', 'A', 'B', 'C'].forEach(t => document.getElementById(`list-${t}`).innerHTML = "");
            const rawHeroes = allData[currentRank];
            if (!rawHeroes) return;

            let heroes = currentRole === 'all' ? [...rawHeroes] : rawHeroes.filter(h => roleMap[h.id] === currentRole);
            heroes.forEach(h => h.metaScore = (h.winRate * 0.3) + (h.pickRate * 2.0));
            heroes.sort((a, b) => b.metaScore - a.metaScore);

            heroes.forEach(hero => {
                const score = hero.metaScore;
                let targetId = score >= 50 ? "list-S" : score >= 35 ? "list-A" : score >= 25 ? "list-B" : "list-C";
                const roleColor = roleMap[hero.id] === "tank" ? "#4d88ff" : roleMap[hero.id] === "support" ? "#4dff88" : "#ff4d4d";
                
                document.getElementById(targetId).innerHTML += `
                    <div class="hero-card" style="border-bottom-color:${roleColor}" onclick="openTrend('${hero.id}', '${hero.name}')">
                        <img src="./images/${hero.id}.png" class="hero-img" onerror="this.src='https://placehold.co/80?text=NoImg'">
                        <span class="stats" style="color:${roleColor}">í”½ë¥  ${hero.pickRate}%</span>
                        <div style="font-size:10px; color:#aaa;">ìŠ¹ë¥  ${hero.winRate}%</div>
                    </div>
                `;
            });
        }

        function openTrend(heroId, heroName) {
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('modal-title').innerText = `${heroName} ìµœê·¼ ìŠ¹ë¥  ì¶”ì„¸`;

            const labels = historyData.map(d => d.date);
            const data = historyData.map(d => {
                const h = d.data[currentRank].find(x => x.id === heroId);
                return h ? h.winRate : null;
            });

            if (trendChart) trendChart.destroy();
            const ctx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ìŠ¹ë¥  (%)',
                        data: data,
                        borderColor: '#ff9c00',
                        tension: 0.3,
                        fill: true,
                        backgroundColor: 'rgba(255, 156, 0, 0.1)'
                    }]
                },
                options: {
                    scales: { y: { grid: { color: '#333' }, ticks: { color: '#ccc' } }, x: { grid: { color: '#333' }, ticks: { color: '#ccc' } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        document.getElementById('rank-select').addEventListener('change', e => { currentRank = e.target.value; render(); });
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentRole = this.dataset.role;
                render();
            });
        });
    </script>
</body>
</html>